import{r as u,R as _}from"./index-Hemj67b4.js";import{u as R}from"./index-DLqmmtYJ.js";import{A as k,N as r,a as p,b as K,c as M,u as Y}from"./useFullKeyboardListeners-CpRGyrUm.js";import{u as $}from"./index-8zVcErkr.js";const B=[...k,...p,...K,...M],W=()=>{const e=u.useRef(document),n=u.useRef(),t=u.useCallback(o=>{n.current=o},[]),a=u.useCallback(({key:o})=>{k.includes(o)?t(r.UP):p.includes(o)?t(r.RIGHT):K.includes(o)?t(r.DOWN):M.includes(o)&&t(r.LEFT)},[t]),c=u.useCallback(()=>{n.current=void 0},[n]);return $({ref:e,capture:!0,keys:B,callback:a}),R({eventName:"mousedown",ref:e,capture:!0,callback:c}),{lastNavigationDirectionRef:n}};function V(e,n){const{topElement:t,bottomElement:a,leftElement:c,rightElement:o}=n;t&&a&&(e[r.UP].get(t)===a&&s("BOTTOM","TOP"),e[r.DOWN].get(a)===t&&s("TOP","BOTTOM")),c&&o&&(e[r.LEFT].get(c)===o&&s("RIGHT","LEFT"),e[r.RIGHT].get(o)===c&&s("LEFT","RIGHT"));function s(f,l){throw new Error(`Circular positioning detected: the ${f} element is already positioned to the ${l} of the ${l} element. This probably means the layout isn't ordered correctly.`)}}const z=e=>{const n={[r.RIGHT]:new Map,[r.LEFT]:new Map,[r.UP]:new Map,[r.DOWN]:new Map};return e.forEach(t=>{V(n,t);const{topElement:a,bottomElement:c,leftElement:o,rightElement:s}=t;a&&c&&(n[r.UP].set(c,a),n[r.DOWN].set(a,c)),o&&s&&(n[r.LEFT].set(s,o),n[r.RIGHT].set(o,s))}),n},X=e=>{switch(e){case r.LEFT:return r.RIGHT;case r.RIGHT:return r.LEFT;case r.UP:return r.DOWN;case r.DOWN:return r.UP;default:throw new Error(`Unexpected direction: ${e}`)}},I=(e,n)=>{const t=e[n],a=[...t][0];if(!a)return[r.LEFT,r.RIGHT].includes(n)?I(e,r.UP):I(e,r.LEFT);const c=a[0];return j(t,c)},O=(e,n)=>{var a;const t=e.get(n);return t?!t.current||t.current.disabled||((a=t.current.dataset)==null?void 0:a.disabled)==="true"?O(e,t):t:null};function j(e,n){let t=!1,a=n;for(;!t;){const c=O(e,a);c?a=c:t=!0}return a}const y=_.createContext(null),re=(e,n,t={disabled:!1})=>{const a=u.useMemo(()=>z(e),[e]),c=u.useContext(y),{lastNavigationDirectionRef:o}=W(),s=u.useCallback(()=>{var N;const l=o.current;if(!l||t.disabled)return;const i=X(l),b=I(a,i);(N=b==null?void 0:b.current)==null||N.focus()},[a,t.disabled,o]);return R({eventName:"focus",callback:s,ref:n}),{onOutboundNavigation:u.useCallback((l,i)=>{var N,T;if(t.disabled)return;const b=O(a[i],l);if(b){(N=l.current)==null||N.blur(),(T=b.current)==null||T.focus();return}c==null||c.onOutboundNavigation(n,i)},[a,c,n,t.disabled])}};function q({direction:e,numberOfItemsInLine:n,itemsCount:t}){const c=(()=>{const o=Math.floor(n/2);if(e===r.UP)return(Math.ceil(t/n)-1)*n+o;if(e===r.DOWN)return o;if(e===r.LEFT){let s=n-1;const f=Math.floor((t-1)/2);for(;s<f;)s+=n;return s}if(e===r.RIGHT){let s=0;const f=Math.floor((t-1)/2);for(;s+n<f;)s+=n;return s}})();return Math.max(0,Math.min(c,t-1))}function G({activeIndex:e,itemsCount:n,numberOfItemsInLine:t,direction:a,circularNavigation:c=!1}){const o=l=>Math.ceil((l+1)/t),s=l=>{let i=e+(l?1:-1);if(i<0||i>=n)if(c)i<0?i=n-1:i>=n&&(i=0);else return{isOutbound:!0};const b=o(e),N=o(i);return b!==N?{isOutbound:!0}:{isOutbound:!1,nextIndex:i}},f=l=>{const i=e+t*(l?1:-1);return i<0||n<=i?{isOutbound:!0}:{isOutbound:!1,nextIndex:i}};switch(a){case r.RIGHT:return s(!0);case r.LEFT:return s(!1);case r.DOWN:return f(!0);case r.UP:return f(!1)}}function J({activeIndex:e,itemsCount:n,numberOfItemsInLine:t,direction:a,disabledIndexes:c=[],circularNavigation:o=!1}){let s=G({activeIndex:e,itemsCount:n,numberOfItemsInLine:t,direction:a,circularNavigation:o});for(;!s.isOutbound&&c.includes(s.nextIndex);)s=G({activeIndex:s.nextIndex,itemsCount:n,numberOfItemsInLine:t,direction:a,circularNavigation:o});return s}const x=-1;function ae({ref:e,itemsCount:n,numberOfItemsInLine:t,onItemClicked:a,entryFocusStrategy:c="directional",getItemByIndex:o=b=>{},focusOnMount:s=!1,focusItemIndexOnMount:f=x,disabledIndexes:l=[],circularNavigation:i=!1}){const[b,N]=u.useState(s&&f!==x),T=u.useRef(!1),[E,g]=u.useState(b?f:x),[h,v]=u.useState(!0),w=u.useContext(y),C=d=>{if(v(!0),E===x){g(0);return}const{isOutbound:A,nextIndex:S}=J({activeIndex:E,itemsCount:n,numberOfItemsInLine:t,direction:d,disabledIndexes:l,circularNavigation:i});A?w==null||w.onOutboundNavigation(e,d):g(S)};u.useEffect(()=>{if(!T.current){T.current=!0;return}N(!1)},[E]);const U=u.useCallback(()=>{var d;return(d=e.current)==null?void 0:d.blur()},[e]),{lastNavigationDirectionRef:F}=W(),m=u.useCallback(()=>{if(E!==x){v(!0);return}const d=F.current;g(c==="directional"&&d?q({direction:d,numberOfItemsInLine:t,itemsCount:n}):0),v(!0)},[E,c,n,F,t,g,v]),H=u.useCallback(()=>{v(!1)},[v]),L=u.useCallback(()=>{v(!0),g(x)},[g]);R({eventName:"focus",callback:m,ref:e}),R({eventName:"mousedown",callback:H,ref:e}),R({eventName:"blur",callback:L,ref:e}),u.useEffect(()=>{var d;E>-1&&((d=e.current)==null||d.focus())},[E,e]);const D=u.useCallback((d,A=!1)=>{v(A),g(d),a(o(d),d)},[g,a,o]),P=u.useCallback(()=>{if(h)return D(E,!0)},[h,D,E]);return Y({ref:e,onSelectionKey:P,onArrowNavigation:C,onEscape:U,focusOnMount:s}),{activeIndex:h?E:x,onSelectionAction:D,isInitialActiveState:b}}export{y as G,re as a,W as b,ae as u};
