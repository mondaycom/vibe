import{r as u,R as $}from"./index-CTZeEbLr.js";import{u as w}from"./index-CkU0kzyk.js";import{A as p,N as r,a as y,b as K,c as H,u as B}from"./useFullKeyboardListeners-Bm0-g7hh.js";import{u as V}from"./index-gB5zY9qh.js";const z=[...p,...y,...K,...H],M=()=>{const t=u.useRef(document),e=u.useRef(),n=u.useCallback(c=>{e.current=c},[]),a=u.useCallback(({key:c})=>{p.includes(c)?n(r.UP):y.includes(c)?n(r.RIGHT):K.includes(c)?n(r.DOWN):H.includes(c)&&n(r.LEFT)},[n]),s=u.useCallback(()=>{e.current=void 0},[e]);return V({ref:t,capture:!0,keys:z,callback:a}),w({eventName:"mousedown",ref:t,capture:!0,callback:s}),{lastNavigationDirectionRef:e}};function X(t,e){const{topElement:n,bottomElement:a,leftElement:s,rightElement:c}=e;n&&a&&(t[r.UP].get(n)===a&&o("BOTTOM","TOP"),t[r.DOWN].get(a)===n&&o("TOP","BOTTOM")),s&&c&&(t[r.LEFT].get(s)===c&&o("RIGHT","LEFT"),t[r.RIGHT].get(c)===s&&o("LEFT","RIGHT"));function o(d,l){throw new Error(`Circular positioning detected: the ${d} element is already positioned to the ${l} of the ${l} element. This probably means the layout isn't ordered correctly.`)}}const j=t=>{const e={[r.RIGHT]:new Map,[r.LEFT]:new Map,[r.UP]:new Map,[r.DOWN]:new Map};return t.forEach(n=>{X(e,n);const{topElement:a,bottomElement:s,leftElement:c,rightElement:o}=n;a&&s&&(e[r.UP].set(s,a),e[r.DOWN].set(a,s)),c&&o&&(e[r.LEFT].set(o,c),e[r.RIGHT].set(c,o))}),e},q=t=>{switch(t){case r.LEFT:return r.RIGHT;case r.RIGHT:return r.LEFT;case r.UP:return r.DOWN;case r.DOWN:return r.UP;default:throw new Error(`Unexpected direction: ${t}`)}},F=(t,e)=>{const n=t[e],a=[...n][0];if(!a)return[r.LEFT,r.RIGHT].includes(e)?F(t,r.UP):F(t,r.LEFT);const s=a[0];return J(n,s)},k=(t,e)=>{var a;const n=t.get(e);return n?!n.current||n.current.disabled||((a=n.current.dataset)==null?void 0:a.disabled)==="true"?k(t,n):n:null};function J(t,e){let n=!1,a=e;for(;!n;){const s=k(t,a);s?a=s:n=!0}return a}const W=$.createContext(null),oe=(t,e,n={disabled:!1})=>{const a=u.useMemo(()=>j(t),[t]),s=u.useContext(W),{lastNavigationDirectionRef:c}=M(),o=u.useCallback(()=>{var v;const l=c.current;if(!l||n.disabled)return;const i=q(l),E=F(a,i);(v=E==null?void 0:E.current)==null||v.focus()},[a,n.disabled,c]);return w({eventName:"focus",callback:o,ref:e}),{onOutboundNavigation:u.useCallback((l,i)=>{var v,x;if(n.disabled)return;const E=k(a[i],l);if(E){(v=l.current)==null||v.blur(),(x=E.current)==null||x.focus();return}s==null||s.onOutboundNavigation(e,i)},[a,s,e,n.disabled])}};function Q({direction:t,numberOfItemsInLine:e,itemsCount:n}){const s=(()=>{const c=Math.floor(e/2);if(t===r.UP)return(Math.ceil(n/e)-1)*e+c;if(t===r.DOWN)return c;if(t===r.LEFT){let o=e-1;const d=Math.floor((n-1)/2);for(;o<d;)o+=e;return o}if(t===r.RIGHT){let o=0;const d=Math.floor((n-1)/2);for(;o+e<d;)o+=e;return o}})();return Math.max(0,Math.min(s,n-1))}function I({activeIndex:t,itemsCount:e,numberOfItemsInLine:n,direction:a,circularNavigation:s=!1}){const c=l=>Math.ceil((l+1)/n),o=l=>{let i=t+(l?1:-1);if(i<0||i>=e)if(s)i<0?i=e-1:i>=e&&(i=0);else return{isOutbound:!0};const E=c(t),v=c(i);return E!==v?{isOutbound:!0}:{isOutbound:!1,nextIndex:i}},d=l=>{const i=t+n*(l?1:-1);return i<0||e<=i?{isOutbound:!0}:{isOutbound:!1,nextIndex:i}};switch(a){case r.RIGHT:return o(!0);case r.LEFT:return o(!1);case r.DOWN:return d(!0);case r.UP:return d(!1)}}function Z({activeIndex:t,itemsCount:e,numberOfItemsInLine:n,direction:a,disabledIndexes:s=[],circularNavigation:c=!1}){let o=I({activeIndex:t,itemsCount:e,numberOfItemsInLine:n,direction:a,circularNavigation:c});for(;!o.isOutbound&&s.includes(o.nextIndex);)o=I({activeIndex:o.nextIndex,itemsCount:e,numberOfItemsInLine:n,direction:a,circularNavigation:c});return o}const T=-1;function ce({ref:t,itemsCount:e,numberOfItemsInLine:n,onItemClicked:a,entryFocusStrategy:s="directional",getItemByIndex:c=E=>{},focusOnMount:o=!1,focusItemIndexOnMount:d=T,disabledIndexes:l=[],circularNavigation:i=!1}){const[E,v]=u.useState(o&&d!==T),x=u.useRef(!1),[g,b]=u.useState(E?d:T),[A,N]=u.useState(!0),D=u.useContext(W),_=f=>{if(N(!0),g===T){b(0);return}const{isOutbound:h,nextIndex:R}=Z({activeIndex:g,itemsCount:e,numberOfItemsInLine:n,direction:f,disabledIndexes:l,circularNavigation:i});h?D==null||D.onOutboundNavigation(t,f):b(R)},U=u.useCallback(()=>{N(!0);const f=l.includes(0)&&l.length<e?Array.from({length:e},(h,R)=>R).find(h=>!l.includes(h))??0:0;b(f)},[l,e]),L=u.useCallback(()=>{N(!0);const f=l.includes(e-1)&&l.length<e?Array.from({length:e},(h,R)=>e-1-R).find(h=>!l.includes(h))??e-1:e-1;b(f)},[l,e]);u.useEffect(()=>{if(!x.current){x.current=!0;return}v(!1)},[g]);const P=u.useCallback(()=>{var f;return(f=t.current)==null?void 0:f.blur()},[t]),{lastNavigationDirectionRef:G}=M(),S=u.useCallback(()=>{if(g!==T){N(!0);return}const f=G.current;b(s==="directional"&&f?Q({direction:f,numberOfItemsInLine:n,itemsCount:e}):0),N(!0)},[g,s,e,G,n,b,N]),m=u.useCallback(()=>{N(!1)},[N]),Y=u.useCallback(()=>{N(!0),b(T)},[b]);w({eventName:"focus",callback:S,ref:t}),w({eventName:"mousedown",callback:m,ref:t}),w({eventName:"blur",callback:Y,ref:t}),u.useEffect(()=>{var f;g>-1&&((f=t.current)==null||f.focus())},[g,t]);const O=u.useCallback((f,h=!1)=>{N(h),b(f),a(c(f),f)},[b,a,c]),C=u.useCallback(()=>{if(A)return O(g,!0)},[A,O,g]);return B({ref:t,onSelectionKey:C,onArrowNavigation:_,onEscape:P,onHome:U,onEnd:L,focusOnMount:o}),{activeIndex:A?g:T,onSelectionAction:O,isInitialActiveState:E}}export{W as G,oe as a,M as b,ce as u};
