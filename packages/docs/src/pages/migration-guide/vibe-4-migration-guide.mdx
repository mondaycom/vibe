import { Meta } from "@storybook/blocks";
import { DiffCodeBlock } from "./DiffCodeBlock";

<Meta title="Vibe 4 Migration Guide" />

# Vibe 4 Migration Guide

<div style={{ lineHeight: "1.8" }}>

- [Intro](#intro)
- [Migration Steps](#migration-steps-)
- [Breaking Changes](#breaking-changes-)
  - [Components](#components)

## Intro

Vibe 4 is the next major version of the Vibe design system. This guide will help you migrate from Vibe 3 to Vibe 4.

## Migration Steps ðŸš€

1. Update `@vibe/core` to the latest version:

   ```bash
   yarn add @vibe/core@^4.0.0
   ```

2. Run the migration script to update your codebase:

   ```bash
   npx @vibe/codemod -m v4
   ```

3. Follow the changes in the [Breaking Changes](#breaking-changes-) section below and apply any manual changes required.

4. **Review the changes and test your application thoroughly.**

## Breaking Changes ðŸš¨

### Components

**DatePicker**

The legacy `DatePicker` component (which relied on `moment.js` and `react-dates`) has been **removed**. Use the modern `DatePicker` from `@vibe/core/next` instead, which uses native `Date` objects and `date-fns`.

As a result, `moment` is no longer a peer dependency of `@vibe/core`.

**Migration:**

1. Update your import:

<ul>
  <DiffCodeBlock
    code={`- import { DatePicker } from "@vibe/core";
+ import { DatePicker } from "@vibe/core/next";`}
  />
</ul>

2. Replace `moment` objects with native `Date` objects:

<ul>
  <DiffCodeBlock
    code={`- import moment from "moment";
- const [date, setDate] = useState(moment("2023-05-01"));
+ const [date, setDate] = useState(new Date("2023-05-01"));`}
  />
</ul>

3. Update the component props:

<ul>
  <DiffCodeBlock
    code={`- <DatePicker date={date} onPickDate={(d) => setDate(d)} />
+ <DatePicker date={date} onDateChange={(d) => setDate(d)} />`}
  />
</ul>

4. For range mode, update the API:

<ul>
  <DiffCodeBlock
    code={`- <DatePicker range date={startDate} endDate={endDate} onPickDate={({ startDate, endDate }) => { ... }} />
+ <DatePicker mode="range" date={startDate} endDate={endDate} onDateChange={({ date, endDate }) => { ... }} />`}
  />
</ul>

5. Remove `moment` from your dependencies if it was only used for the DatePicker:

   ```bash
   yarn remove moment
   ```

**Key API changes:**

| Legacy (`@vibe/core`) | New (`@vibe/core/next`) |
|---|---|
| `date: moment.Moment` | `date: Date` |
| `onPickDate` | `onDateChange` |
| `range: boolean` | `mode: "single" \| "range"` |
| `startDate` / `endDate` (Moment) | `date` / `endDate` (Date) |
| `moment` peer dependency | No `moment` dependency |

</div>
