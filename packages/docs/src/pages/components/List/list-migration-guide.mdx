import { Meta } from "@storybook/blocks";
import { Tip, Link } from "vibe-storybook-components";

<Meta title="Components/List [New]/Migration Guide" />

# List Migration Guide

This guide helps you migrate from the legacy List component to the new List component.

## Overview

The new List component has been rebuilt from the ground up with:
- **Better accessibility**: Proper ARIA attributes, keyboard navigation with wrap-around, and role support
- **Cleaner API**: Data-driven ListItem props instead of composing child components
- **Improved performance**: Lighter weight without virtualization overhead
- **Better TypeScript support**: Strongly typed props derived from base types

## Import Changes

### Before (Legacy)

```js
import { List, ListItem, ListItemIcon, ListItemAvatar } from "@vibe/core";
```

### After (New)

```js
import { List, ListItem } from "@vibe/core/next";
```

## API Changes

### List Component

| Legacy Prop | New Prop | Notes |
|-------------|----------|-------|
| `children` | `children` | Now accepts `ListItem` components only |
| `className` | `className` | Unchanged |
| `id` | `id` | Unchanged |
| `style` | `style` | Unchanged |
| `component` | `as` | Renamed for consistency with other components |
| `dense` | `size` | Use `size="small"` instead of `dense` |
| `renderOnlyVisibleItems` | - | Removed (virtualization not supported) |
| - | `ariaLabel` | **New**: Required for accessibility |
| - | `ariaDescribedBy` | **New**: Optional accessibility enhancement |
| - | `role` | **New**: Defaults to "listbox", supports "menu", "list" |
| - | `maxHeight` | **New**: For scrollable lists |
| - | `focusOnMount` | **New**: Auto-focus on mount |
| - | `defaultFocusIndex` | **New**: Initial focused item |
| - | `onFocusChange` | **New**: Focus tracking callback |
| - | `disabled` | **New**: Disable entire list |

### ListItem Component

The new ListItem uses a data-driven API instead of composing children.

| Legacy Pattern | New Pattern |
|----------------|-------------|
| `<ListItem>Text</ListItem>` | `<ListItem label="Text" />` |
| `<ListItem><ListItemIcon icon={Icon} />Text</ListItem>` | `<ListItem label="Text" startElement={{ type: "icon", value: Icon }} />` |
| `<ListItem><ListItemAvatar src={src} />Text</ListItem>` | `<ListItem label="Text" startElement={{ type: "avatar", value: src }} />` |
| `<ListItem selected>Text</ListItem>` | `<ListItem label="Text" selected />` |
| `<ListItem disabled>Text</ListItem>` | `<ListItem label="Text" disabled />` |

### New ListItem Props

| Prop | Type | Description |
|------|------|-------------|
| `label` | `string` | The text content of the item |
| `value` | `string` | Unique identifier (defaults to label) |
| `startElement` | `{ type: "icon" \| "avatar", value: ... }` | Element before label |
| `endElement` | `{ type: "icon" \| "suffix", value: ... }` | Element after label |
| `selected` | `boolean` | Selection state |
| `disabled` | `boolean` | Disabled state |
| `readOnly` | `boolean` | Read-only state |
| `onClick` | `function` | Click handler |
| `children` | `ReactNode` | Custom content (overrides label) |

## Migration Examples

### Basic List

**Before:**
```jsx
<List>
  <ListItem onClick={handleClick}>Board Power up</ListItem>
  <ListItem onClick={handleClick}>Team Power up</ListItem>
</List>
```

**After:**
```jsx
<List ariaLabel="Power ups">
  <ListItem label="Board Power up" onClick={handleClick} />
  <ListItem label="Team Power up" onClick={handleClick} />
</List>
```

### List with Icons

**Before:**
```jsx
<List>
  <ListItem>
    <ListItemIcon icon={Board} />
    Board name
  </ListItem>
  <ListItem>
    <ListItemIcon icon={Team} />
    Team name
  </ListItem>
</List>
```

**After:**
```jsx
<List ariaLabel="Items with icons">
  <ListItem
    label="Board name"
    startElement={{ type: "icon", value: Board }}
  />
  <ListItem
    label="Team name"
    startElement={{ type: "icon", value: Team }}
  />
</List>
```

### List with Avatars

**Before:**
```jsx
<List>
  <ListItem>
    <ListItemAvatar src={person1} />
    John Doe
  </ListItem>
</List>
```

**After:**
```jsx
<List ariaLabel="Team members">
  <ListItem
    label="John Doe"
    startElement={{ type: "avatar", value: person1 }}
  />
</List>
```

### Virtualized List

<Tip title="Important" emoji="⚠️">
  The new List component does not support virtualization. If you need to render large lists
  with thousands of items, continue using the legacy List component with `renderOnlyVisibleItems`.
</Tip>

## Removed Features

### ListTitle

The new List does not include a `ListTitle` component. If you need categories, use a custom heading element outside the list or use the Divider component between groups.

### ListItemIcon / ListItemAvatar

These sub-components are replaced by the `startElement` prop on `ListItem`.

### Virtualization

The `renderOnlyVisibleItems` prop is not supported. For large lists requiring virtualization, continue using the legacy List.

## Accessibility Improvements

The new List provides:

1. **Required `ariaLabel`**: Ensures lists are properly labeled for screen readers
2. **Keyboard Navigation**: Arrow keys, Home, End, PageUp, PageDown with wrap-around
3. **Focus Management**: `focusOnMount`, `defaultFocusIndex`, and `onFocusChange`
4. **Role Support**: `listbox` (default), `menu`, or `list` roles
5. **Proper ARIA Attributes**: `aria-activedescendant`, `aria-selected`, etc.

## TypeScript

The new components have improved TypeScript support with types derived from base components:

```ts
import { List, ListItem, type ListProps, type ListItemProps } from "@vibe/core/next";
```
